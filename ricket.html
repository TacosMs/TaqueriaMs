<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Impresión Ticket - Taquería MS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #d97706;
            --secondary: #f59e0b;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            padding: 20px;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 20px auto;
        }
        .test-button {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background-color: #b65c04;
        }
        /* Tailwind 'hidden' class for reference: .hidden { display: none; } */

        /* ESTILOS PARA LA IMPRESIÓN */
        @media print {
            body.printing * { /* Apply hiding rules when body has 'printing' class */
                visibility: hidden;
            }

            /* Hide elements specifically marked as no-print */
            .no-print {
                display: none !important;
            }

            #printable-receipt {
                display: block !important; /* Crucial: Overrides Tailwind's .hidden */
                visibility: visible !important;
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm; /* O ajusta a '280px' o '300px' */
                margin: 0;
                padding: 5mm;
                font-family: 'Courier New', Courier, monospace !important;
                font-size: 10pt !important;
                color: #000 !important;
                background-color: #fff !important; /* Asegura fondo blanco */
                box-sizing: border-box !important;
                border: 1px solid #000; /* Borde negro para que sea visible si es solo el cuadro */
            }

            #printable-receipt *, #printable-receipt *::before, #printable-receipt *::after {
                visibility: visible !important;
                color: #000 !important;
                background-color: transparent !important; /* Hijos con fondo transparente */
                font-family: 'Courier New', Courier, monospace !important;
                font-size: inherit !important; /* Hereda tamaño de fuente del padre */
            }

            #printable-receipt h1,
            #printable-receipt h2,
            #printable-receipt h3,
            #printable-receipt p,
            #printable-receipt div,
            #printable-receipt span {
                 /* Asegura que estos elementos no tengan estilos extra que los oculten o coloreen de gris */
                box-shadow: none !important;
                text-shadow: none !important;
            }

            #printable-receipt h1 { font-size: 14pt !important; font-weight: bold !important; text-align: center;}
            #printable-receipt p { margin: 2px 0 !important; font-size: 9pt !important;}
            #printable-receipt hr {
                border: none !important;
                border-top: 1px dashed #000 !important;
                margin: 5px 0 !important;
                visibility: visible !important; /* Asegura que hr sea visible */
                display: block !important; /* Asegura que hr se muestre */
            }
            #printable-receipt .receipt-item {
                display: flex !important;
                justify-content: space-between !important;
                margin: 3px 0 !important;
                font-size: 9pt !important;
            }
            #printable-receipt .receipt-item .item-name {
                flex-grow: 1 !important;
                text-align: left !important;
            }
            #printable-receipt .item-qty {
                width: 35px !important;
                text-align: right !important;
                padding-right: 5px !important;
                flex-shrink: 0 !important;
            }
            #printable-receipt .item-total {
                width: 55px !important;
                text-align: right !important;
                flex-shrink: 0 !important;
            }
            #printable-receipt .receipt-customizations {
                font-size: 8pt !important;
                padding-left: 10px !important;
                color: #333 !important; /* Un gris oscuro para diferenciarse, pero no el gris del contenedor */
                margin: 1px 0 3px 0 !important;
            }
            #printable-receipt .receipt-total {
                display: flex !important;
                justify-content: space-between !important;
                font-weight: bold !important;
                font-size: 11pt !important;
                margin-top: 8px !important;
                padding-top: 5px !important;
            }
            #printable-receipt .footer-message {
                text-align: center !important;
                margin-top: 15px !important;
                font-size: 8pt !important;
            }
        }
    </style>
</head>
<body>

    <div class="container no-print">
        <h1 class="text-2xl font-bold text-center mb-6 text-amber-600">Prueba de Impresión de Ticket</h1>
        <p class="text-center mb-4">
            Este es un ejemplo para probar cómo se vería un ticket impreso desde el sistema de punto de venta.
            Al hacer clic en el botón, se generará un ticket de ejemplo y se abrirá el diálogo de impresión de tu navegador.
        </p>
        <div class="text-center">
            <button id="test-print-button" class="test-button">
                <i class="fas fa-print mr-2"></i>Generar e Imprimir Ticket de Prueba
            </button>
        </div>
        <p class="mt-4 text-sm text-gray-600">Si ves un cuadro gris al imprimir, asegúrate de que en la configuración de impresión de tu navegador (en el diálogo de impresión) no esté activada alguna opción como "Imprimir solo selección" o que "Imprimir gráficos de fondo" esté desactivada si eso afecta el contenido.</p>
    </div>

    <div id="printable-receipt" class="hidden">
        </div>

<script>
    const sampleOrderData = [
        { id: 1, name: "Taco de Bistec", price: 30, quantity: 2, customizations: { ingredients: ["salsa-roja", "cebolla"], notes: "Bien dorado" } },
        { id: 2, name: "Taco de Longaniza", price: 30, quantity: 3, customizations: { ingredients: ["salsa-verde"], notes: "" } },
        { id: 7, name: "Taco de Alambre", price: 32, quantity: 1, customizations: { ingredients: [], notes: "Sin queso" } },
        { id: 15, name: "7UP", price: 25, quantity: 2, customizations: { ingredients: ["hielo"], notes: "" } },
        { id: 8, name: "Burrito de Bistec Supremo Extralargo con todo", price: 48, quantity: 1, customizations: { ingredients: ["salsa-roja", "cebolla"], notes: "Para llevar" } }
    ];

    function printReceiptContent(tableNumber, orderItems) {
        const printableArea = document.getElementById('printable-receipt');
        if (!printableArea) {
            console.error("Elemento #printable-receipt no encontrado.");
            return;
        }

        if (!orderItems || orderItems.length === 0) {
            alert("No hay items en la orden para imprimir.");
            return;
        }

        const now = new Date();
        const dateStr = now.toLocaleDateString('es-MX', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });

        let receiptHTML = `
            <h1>TAQUERÍA MS</h1>
            <p style="text-align:center; font-size:8pt;">Av. Pantitlán 397, Evolución, Nezahualcóyotl</p>
            <p style="text-align:center; font-size:8pt;">Tel: 55 1234 5678</p>
            <hr>
            <p>Mesa: #${tableNumber}</p>
            <p>Fecha: ${dateStr} &nbsp;&nbsp; Hora: ${timeStr}</p>
            <hr>
            <div class="receipt-item" style="font-weight:bold;">
                <span class="item-name">Descripción</span>
                <span class="item-qty">Cant.</span>
                <span class="item-total">Total</span>
            </div>
            <hr>
        `;

        let calculatedTotal = 0;
        orderItems.forEach(item => {
            const itemTotal = item.price * item.quantity;
            calculatedTotal += itemTotal;
            receiptHTML += `
                <div class="receipt-item">
                    <span class="item-name">${item.name}</span>
                    <span class="item-qty">${item.quantity}</span>
                    <span class="item-total">$${itemTotal.toFixed(2)}</span>
                </div>
            `;
            if (item.customizations) {
                let custText = '';
                if (item.customizations.ingredients && item.customizations.ingredients.length > 0) {
                    custText += item.customizations.ingredients.map(ing => {
                        return ing.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    }).join(', ');
                }
                if (item.customizations.notes) {
                    custText += (custText ? ' | ' : '') + `Nota: ${item.customizations.notes}`;
                }
                if (custText) {
                    receiptHTML += `<div class="receipt-customizations">&nbsp;&nbsp;(${custText})</div>`;
                }
            }
        });

        receiptHTML += `
            <hr>
            <div class="receipt-total">
                <span>TOTAL:</span>
                <span>$${calculatedTotal.toFixed(2)}</span>
            </div>
            <hr>
            <div class="footer-message">
                <p>¡Gracias por su preferencia!</p>
                <p style="font-size:7pt;">TAQUERÍA MS - Software de Prueba</p>
            </div>
        `;

        printableArea.innerHTML = receiptHTML;
        
        // Preparamos el body y el área imprimible para la impresión
        document.body.classList.add('printing'); // Ayuda a los estilos @media print a ser más específicos
        printableArea.classList.remove('hidden'); // Quitamos la clase .hidden de Tailwind

        window.print(); // Abre el diálogo de impresión

        // Limpiamos después de imprimir
        // Usar un pequeño retardo o el evento onafterprint (este último tiene soporte variable)
        setTimeout(() => {
            printableArea.classList.add('hidden'); // Volvemos a ocultar el área
            document.body.classList.remove('printing');
            // printableArea.innerHTML = ''; // Opcional: limpiar el contenido si no se va a reusar inmediatamente
        }, 300); // Un retardo corto
    }

    document.getElementById('test-print-button').addEventListener('click', () => {
        printReceiptContent(5, sampleOrderData);
    });
</script>

</body>
</html>