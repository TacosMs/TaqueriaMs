<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Impresión Ticket - Taquería MS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #d97706;
            --secondary: #f59e0b;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f0f0; /* Un fondo claro para la página de prueba */
            color: #333;
            padding: 20px;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 20px auto;
        }
        .test-button {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background-color: #b65c04;
        }

        /* ESTILOS PARA LA IMPRESIÓN */
        @media print {
            body * {
                visibility: hidden; /* Oculta todo en la página por defecto */
            }
            #printable-receipt, #printable-receipt * {
                visibility: visible; /* Muestra solo el ticket y su contenido */
            }
            #printable-receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm; /* Ancho típico de ticket, o ajusta a '280px' o '300px' */
                               /* Para hoja A4/Carta, esto se imprimirá como una columna */
                margin: 0;
                padding: 5mm;
                font-family: 'Courier New', Courier, monospace;
                font-size: 10pt;
                color: #000;
                background-color: #fff;
                box-sizing: border-box;
                border: 1px solid #ccc; /* Borde opcional para ver el área en la vista previa */
            }
            #printable-receipt h1, 
            #printable-receipt h2,
            #printable-receipt h3 {
                text-align: center;
                margin: 5px 0;
                color: #000;
            }
            #printable-receipt hr {
                border: none;
                border-top: 1px dashed #000;
                margin: 5px 0;
            }
            #printable-receipt h1 { font-size: 14pt; font-weight: bold; }
            #printable-receipt h2 { font-size: 10pt; }
            #printable-receipt h3 { font-size: 10pt; font-weight: bold; border-top: 1px dashed #000; border-bottom: 1px dashed #000; margin-top: 10px; padding: 5px 0;}
            #printable-receipt p { margin: 2px 0; color: #000; font-size: 9pt;}
            #printable-receipt .receipt-item {
                display: flex;
                justify-content: space-between;
                margin: 3px 0;
                font-size: 9pt;
            }
            #printable-receipt .receipt-item .item-name {
                flex-grow: 1;
                text-align: left;
                /* word-break: break-all; */ /* Descomentar si los nombres son muy largos */
            }
            #printable-receipt .item-qty {
                width: 35px;
                text-align: right;
                padding-right: 5px;
                flex-shrink: 0;
            }
            #printable-receipt .item-total {
                width: 55px;
                text-align: right;
                flex-shrink: 0;
            }
            #printable-receipt .receipt-customizations {
                font-size: 8pt;
                padding-left: 10px;
                color: #333;
                margin: 1px 0 3px 0;
            }
            #printable-receipt .receipt-total {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                font-size: 11pt;
                margin-top: 8px;
                padding-top: 5px;
            }
            #printable-receipt .footer-message {
                text-align: center;
                margin-top: 15px;
                font-size: 8pt;
            }
            /* Oculta el botón de prueba en la impresión */
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-2xl font-bold text-center mb-6 text-amber-600">Prueba de Impresión de Ticket</h1>
        <p class="text-center mb-4">
            Este es un ejemplo para probar cómo se vería un ticket impreso desde el sistema de punto de venta.
            Al hacer clic en el botón, se generará un ticket de ejemplo y se abrirá el diálogo de impresión de tu navegador.
        </p>
        <div class="text-center">
            <button id="test-print-button" class="test-button no-print">
                <i class="fas fa-print mr-2"></i>Generar e Imprimir Ticket de Prueba
            </button>
        </div>
    </div>

    <div id="printable-receipt" class="hidden">
        </div>

<script>
    // Datos de ejemplo para la orden (simulando appState.orders[table])
    const sampleOrderData = [
        { id: 1, name: "Taco de Bistec", price: 30, quantity: 2, customizations: { ingredients: ["salsa-roja", "cebolla"], notes: "Bien dorado" } },
        { id: 2, name: "Taco de Longaniza", price: 30, quantity: 3, customizations: { ingredients: ["salsa-verde"], notes: "" } },
        { id: 7, name: "Taco de Alambre", price: 32, quantity: 1, customizations: { ingredients: [], notes: "Sin queso" } },
        { id: 15, name: "7UP", price: 25, quantity: 2, customizations: { ingredients: ["hielo"], notes: "" } },
        { id: 8, name: "Burrito de Bistec Supremo Extralargo con todo", price: 48, quantity: 1, customizations: { ingredients: ["salsa-roja", "cebolla"], notes: "Para llevar" } }
    ];

    function printReceiptContent(tableNumber, orderItems) {
        const printableArea = document.getElementById('printable-receipt');
        if (!printableArea) {
            console.error("Elemento #printable-receipt no encontrado.");
            return;
        }

        if (!orderItems || orderItems.length === 0) {
            alert("No hay items en la orden para imprimir.");
            return;
        }

        const now = new Date();
        const dateStr = now.toLocaleDateString('es-MX', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });

        let receiptHTML = `
            <h1>TAQUERÍA MS</h1>
            <p style="text-align:center; font-size:8pt;">Av. Pantitlán 397, Evolución, Nezahualcóyotl</p>
            <p style="text-align:center; font-size:8pt;">Tel: 55 1234 5678</p>
            <hr>
            <p>Mesa: #${tableNumber}</p>
            <p>Fecha: ${dateStr} &nbsp;&nbsp; Hora: ${timeStr}</p>
            <hr>
            <div class="receipt-item" style="font-weight:bold;">
                <span class="item-name">Descripción</span>
                <span class="item-qty">Cant.</span>
                <span class="item-total">Total</span>
            </div>
            <hr>
        `;

        // No es necesario agrupar aquí si sampleOrderData ya tiene 'quantity'
        let calculatedTotal = 0;
        orderItems.forEach(item => {
            const itemTotal = item.price * item.quantity;
            calculatedTotal += itemTotal;
            receiptHTML += `
                <div class="receipt-item">
                    <span class="item-name">${item.name}</span>
                    <span class="item-qty">${item.quantity}</span>
                    <span class="item-total">$${itemTotal.toFixed(2)}</span>
                </div>
            `;
            if (item.customizations) {
                let custText = '';
                if (item.customizations.ingredients && item.customizations.ingredients.length > 0) {
                    custText += item.customizations.ingredients.map(ing => {
                        return ing.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    }).join(', ');
                }
                if (item.customizations.notes) {
                    custText += (custText ? ' | ' : '') + `Nota: ${item.customizations.notes}`;
                }
                if (custText) {
                    receiptHTML += `<div class="receipt-customizations">&nbsp;&nbsp;(${custText})</div>`;
                }
            }
        });

        receiptHTML += `
            <hr>
            <div class="receipt-total">
                <span>TOTAL:</span>
                <span>$${calculatedTotal.toFixed(2)}</span>
            </div>
            <hr>
            <div class="footer-message">
                <p>¡Gracias por su preferencia!</p>
                <p style="font-size:7pt;">TAQUERÍA MS - Software de Prueba</p>
            </div>
        `;

        printableArea.innerHTML = receiptHTML;
        // printableArea.classList.remove('hidden'); // No es estrictamente necesario si @media print lo maneja

        window.print(); // Abre el diálogo de impresión

        // Opcional: limpiar después de imprimir para no afectar la página si se vuelve a interactuar
        // setTimeout(() => {
        //    printableArea.innerHTML = '';
        // }, 1000);
    }

    document.getElementById('test-print-button').addEventListener('click', () => {
        // Llamamos a la función con datos de ejemplo
        // Simulamos que es la mesa 5
        printReceiptContent(5, sampleOrderData);
    });
</script>

</body>
</html>